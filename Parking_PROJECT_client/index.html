<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>首頁</title>

    <!-- css -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">

    <!-- design -->
    <link rel="stylesheet" href="assets/css/index/design.css">

    <!-- ncBtn -->
    <link rel="stylesheet" href="assets/css/index/ncBtn.css">

    <!-- animate -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />

    <!-- icon -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.4/font/bootstrap-icons.css">

    <!-- map -->
    <script src="./assets/js/map_control_js/leaflet/leaflet.js"></script>
    <link rel="stylesheet" href="./assets/css/map_control_css/leaflet/leaflet.css" />

    <!-- jQuery -->
    <script src="./assets/js/jquery-3.6.4.min.js"></script>

</head>

<body>

    <!-- 導覽列 -->
    <nav class="navbar">
        <div class="container">
            <a class="" href="#">
                <img src="./assets/image/index/logo-yellow.png" width="150px">
            </a>

            <div class="navbar-nav">
                <!-- 登入前 -->
                <!-- <a class="nav-link login me-3" href="register.html">註冊</a>
                <a class="nav-link login " href="login.html">登入</a> -->

                <!-- 登入後 -->
                <!-- <a class="nav-link logout me-3" href="#"><i class="bi bi-app-indicator"></i></a>
                <div class="dropdown">
                    <button class="btn dropdown-toggle nav-link logout text-white" type="button" data-bs-toggle="dropdown"
                        aria-expanded="false" id="userhello">
                    </button>
                    <ul class="dropdown-menu" style="">
                        <li><a class="dropdown-item logout" href="#">繳費紀錄</a></li>
                        <li><a class="dropdown-item logout clearLocalStroage" href="login.html">登出</a></li>
                    </ul>
                </div> -->

                <!-- 通知變數後續調整 : https://icons.getbootstrap.com/icons/app-indicator/ -->
            </div>
        </div>
    </nav>



    <!-- 主視覺 -->
    <section class="bg-blue container-fluid py-4">
        <div class="container">
            <div class="row">
                <div class="col-12 col-md-6 animate__animated animate__bounceInLeft">
                    <h1 class="pt-3 text-white">用最快的速度! 找到停車位!</h1>
                    <div class="input-group flex-nowrap">
                        <span class="input-group-text" id="addon-wrapping"><i class="bi bi-geo-alt"></i></span>
                        <input type="text" class="form-control" id="searchPlace" placeholder="快速查找">
                    </div>
                    <div class="my-3"></div>
                    <button type="button" class="btn btn-outline-light" id="targetBtn">最近停車位！</button>

                </div>
                <div class="col-12 col-md-6">
                    <img src="./assets/image/index/index-01.png"
                        class="img-fluid animate__animated animate__bounceInRight">
                </div>
            </div>
        </div>

    </section>

    <!-- 四大功能介紹 -->
    <section class="container py-4 animate__animated animate__fadeInUp">
        <div class="row">
            <div class="col-12 ">
                <h1 class="text-center">快速找停車，Car Parking都GO付</h1>
                <h6 class="text-center">免嗶免掃免下車免感應 ， 一切App付款輕鬆達成 !</h6>
            </div>
            <div class="col-12 mt-3">
                <div class="row">
                    <div class="col-6 col-md-3">
                        <div class="card text-bg-white mb-3 shadow-sm" style="max-width: 18rem;">
                            <div class="p-3 text-center">
                                <img src="./assets/image/index/index-02.png" class="img-fluid">
                            </div>
                            <div class="card-body">
                                <h4 class="card-title text-center">停車流量</h4>
                                <h6 class="card-text text-center">掌握時間與空位 預先判斷</h6>
                            </div>
                        </div>
                    </div>
                    <div class="col-6 col-md-3">
                        <div class="card text-bg-white mb-3 shadow-sm" style="max-width: 18rem;">
                            <div class="p-3 text-center">
                                <img src="./assets/image/index/index-05.png" class="img-fluid">
                            </div>
                            <div class="card-body">
                                <h4 class="card-title text-center">停車場</h4>
                                <h6 class="card-text text-center">繳費免排隊 直接開出場</h6>
                            </div>
                        </div>
                    </div>
                    <div class="col-6 col-md-3">
                        <div class="card text-bg-white mb-3 shadow-sm" style="max-width: 18rem;">
                            <div class="p-3 text-center">
                                <img src="./assets/image/index/index-04.png" class="img-fluid">
                            </div>
                            <div class="card-body">
                                <h4 class="card-title text-center">路邊停車</h4>
                                <h6 class="card-text text-center">超商免繳單 在家線上繳</h6>
                            </div>
                        </div>
                    </div>
                    <div class="col-6 col-md-3">
                        <div class="card text-bg-white mb-3 shadow-sm" style="max-width: 18rem;">
                            <div class="p-3 text-center">
                                <img src="./assets/image/index/index-03.png" class="img-fluid">
                            </div>
                            <div class="card-body">
                                <h4 class="card-title text-center">車宿地點</h4>
                                <h6 class="card-text text-center">野外露宿更簡單</h6>
                            </div>
                        </div>
                    </div>

                </div>

            </div>
        </div>
    </section>

    <!-- 手機樣式簡介 -->
    <section class="container-fluid bg-light-subtle py-5 ">
        <div class="container">
            <div class="row">
                <div class="rounded-4 shadow-sm bg-white py-5 position-relative mx-md-auto" style="max-width: 800px;">
                    <h1 class="text-center mb-4">開到哪，付到哪</h1>
                    <img src="./assets/image/index/index-07.png" class="bg-app_a" alt="">
                    <div class="appText_a">
                        <div>
                            <h3>支援付款場合</h3>
                            <p class="mb-2">Car Parking 都任你付 ! 點擊下方查詢支援場站 。</p>
                            <button type="button" class="btn btn-sm btn-outline-primary payment">停車繳費</button>
                        </div>
                        <div class="mt-4">
                            <h3>汽機車停車費</h3>
                            <p>透過 Car Parking 付 ， 自動繳費功能，縣市路邊停車費 ， 每日即時自動繳清 ， 再也免跑超商。</p>
                        </div>
                    </div>

                </div>

            </div>
        </div>
    </section>

    <!-- 手機樣式簡介2 -->
    <section class="container-fluid py-5 px-0 mt-5 object-fit-scale ">
        <div class="bg-yellow py-5 ">
            <div class="position-relative mx-md-auto" style="max-width: 900px;">

                <img src="./assets/image/index/index-08.png" class="bg-app_b">
                <div class="container px-5 appText_b">
                    <h1>綁定車牌<br>立即上路使用 Car Parking !</h1>
                    <button type="button" class="btn btn-dark mobile_v13">立即使用 !</button>
                </div>
            </div>
        </div>
    </section>

    <!-- 輕鬆設定 ， 即可出發 -->
    <section class="container-fluid bg-light-subtle py-5 ">
        <div class="container">
            <div class="row justify-content-md-center">
                <h1 class="text-center">輕鬆設定 ， 即可出發</h1>
                <h6 class="text-center">在欲使用 App 通路設定好車牌及錢包 ， 開始使用 。 </h6>

                <div class="col-12 col-md-3 text-center d-flex flex-column align-items-center mx-sm-3 mt-3">
                    <div class="rounded-3 shadow-sm bg-white py-5 text-center d-flex align-items-center justify-content-center "
                        style="width: 200px;height:200px">
                        <img src="./assets/image/index/index-09.png" class="" alt="">
                    </div>
                    <div style="width: 200px;">
                        <h4 class="mt-2 text-center">設定車牌</h4>
                        <h6 class=" text-center">可以增多組汽 、 機車車牌來使
                            用 Car Parking 付 。
                            <br>
                            <a href="./Car_Licence_add.html">如何設定</a>
                        </h6>
                    </div>
                </div>
                <div class="col-12 col-md-3 text-center d-flex flex-column align-items-center mx-sm-3 mt-3">
                    <div class="rounded-3 shadow-sm bg-white py-5 text-center  d-flex align-items-center justify-content-center"
                        style="width: 200px;height:200px ;">
                        <img src="./assets/image/index/index-10.png" class="" alt="">
                    </div>
                    <div style="width: 200px;">
                        <h4 class="mt-2 text-center">設定錢包</h4>
                        <h6 class=" text-center">可以儲值錢包，線上方便繳費
                            <br>
                            <a href="./Wallet.html">如何設定</a>
                        </h6>
                    </div>
                </div>
            </div>
        </div>
    </section>


    <!-- 地圖嵌入 -->
    <section class="container py-5">
        <h1 class="text-center">您在這裡</h1>
        <!-- google地圖嵌入 -->
        <!-- <div class="d-flex flex-column align-items-center">
            <iframe
                src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3615.7700089753916!2d121.47339331045227!3d25.007929839249265!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3442a90acfc275d5%3A0x68e97873e54484b6!2z5Zib5Zi75ZmgIG9oIeunm-yeiOuLrS3pn5PlvI_ngrjpm54!5e0!3m2!1szh-TW!2stw!4v1681806250173!5m2!1szh-TW!2stw"
                width="100%" height="450" style="border:0;" allowfullscreen="" loading="lazy"
                referrerpolicy="no-referrer-when-downgrade">
            </iframe>
        </div> -->

        <!-- userMap -->
        <a href="./mobile_v13.html">
            <div id="map"></div>
        </a>

    </section>

    <footer class="bg-black ">
        <div class="container py-5">
            <div class="row">
                <div class="col-sm-6 col-12 mb-4 text-center">
                    <img src="./assets/image/index/index-12.png" alt="" class="img-fluid">
                </div>
                <div class="col-sm-2 col-4">
                    <h3><a href=".//Gold_flow_home.html" class="text-white">會員資訊</a></h3>
                    <h5><a href="./register.html" class="text-white">會員註冊</a></h5>
                    <h5><a href="./NotificationCenter.html" class="text-white">通知訊息</a></h5>
                </div>
                <div class="col-sm-2 col-4">
                    <h3><a href="./Wallet.html" class="text-white">線上錢包</a></h3>
                    <h5><a href="./Trade_record.html" class="text-white">交易紀錄</a></h5>
                    <h5><a href="./Car_Licence_add.html" class="text-white">新增車牌</a></h5>
                    <h5><a href="./Payment.html" class="text-white">線上繳費</a></h5>
                </div>
                <div class="col-sm-2 col-4">
                    <h3 class="text-white">停車場資訊</h3>
                    <h5><a href="./mobile_v13.html" class="text-white">路邊車位</a></h5>
                    <h5><a href="./mobile_v13.html" class="text-white">停車場車位</a></h5>
                    <h5><a href="./mobile_carStay_v3.html" class="text-white">車宿地點</a></h5>
                </div>
            </div>
        </div>
    </footer>

    <!-- 登入後判斷頁面呈現與切換 -->
    <script>
        // 假設 memberID 存在於 localStorage 中
        var memberID = localStorage.getItem('memberID');
        var memberAc = localStorage.getItem('member_ac');

        var loginHtml = `
                <button id="ncBtn" class=" nav-link logout me-3 NotificationCenter"> <i class="bi bi-app-indicator"></i> </button>
                
                <div class="dropdown">
                    <button class="btn dropdown-toggle nav-link logout text-white" type="button" data-bs-toggle="dropdown"
                        aria-expanded="false" id="userhello">
                    </button>
                    <ul class="dropdown-menu" style="">
                        <li><a class="dropdown-item logout" href="./Gold_flow_home.html">會員中心</a></li>
                        <li><a class="dropdown-item logout" href="./Car_Licence_add.html">新增車牌</a></li>
                        <li><a class="dropdown-item logout" href="./Wallet.html">線上錢包</a></li>
                        <li><a class="dropdown-item logout" href="./Payment.html">立即繳費</a></li>
                        <li><a class="dropdown-item logout" href="./Trade_record.html">交易紀錄</a></li>
                        <li><a class="dropdown-item logout clearLocalStroage" href="login.html">登出</a></li>
                    </ul>
                </div>
        `;

        var SignOutHtml = `
                <a class="nav-link login me-3" href="register.html">註冊</a>
                <a class="nav-link login " href="login.html">登入</a>
        `
        if (memberID) {
            // 若 memberID 存在，表示已登入，顯示登出標籤，隱藏登入標籤
            $('.navbar-nav').html(loginHtml);
        } else {
            // 若 memberID 不存在，表示未登入，顯示登入標籤，隱藏登出標籤
            $('.navbar-nav').html(SignOutHtml);
        }

        $('.clearLocalStroage').on('click', function () {
            localStorage.removeItem('memberID');
        });

        $('#userhello').text(memberAc + '你好');
        // $('#userhello').on("click", function(){
        //     window.location = "./Gold_flow_home.html"
        // })

    </script>

    <!-- 導向繳費頁面 -->
    <script>
        $(".payment").on("click", function(){
            window.location = "./Payment.html"
        })
    </script>
    <!-- 導向通知中心 -->
    <script>
        $(".NotificationCenter").on("click", function(){
            window.location = "./NotificationCenter.html"
        })
    </script>
    <!-- 導向停車位查找 -->
    <script>
        $(".mobile_v13").on("click", function(){
            window.location = "./mobile_v13.html"
        })
    </script>
    <!-- map -->
    <script>
        //地圖顯示相關設定
        let zoom = 17; // 0 - 18
        let center = [24.137508915419836, 120.68694731120945]; // 中心點座標
        let map = L.map('map').setView(center, zoom);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '© OpenStreetMap', // 商用時必須要有版權出處
            maxZoom: 18,
            layerLimit: 20, // 設定顯示圖層數量上限為 20
            zoomControl: true, // 是否秀出 - + 按鈕
        }).addTo(map);
        // remove zoomControl
        map.zoomControl.remove();
        // 禁止使用者操作地圖
        map.dragging.disable();
        map.touchZoom.disable();
        map.doubleClickZoom.disable();
        map.scrollWheelZoom.disable();
        map.boxZoom.disable();
        map.keyboard.disable();
        if (map.tap) map.tap.disable();
        document.getElementById('map').style.cursor = 'default';

        //停車場座標icon
        var park60 = L.icon({ //add this new icon
            iconUrl: './assets/image/map_control_img/park60.png',
            iconSize: [20, 25], // size of the icon
        }); //停車場綠燈座標圖
        var park30 = L.icon({
            iconUrl: './assets/image/map_control_img/park30.png',
            iconSize: [20, 25],
        }); //停車場黃燈座標圖
        var park0 = L.icon({
            iconUrl: './assets/image/map_control_img/park0.png',
            iconSize: [20, 25]
        }); //停車場紅燈座標圖

        // 路邊車格icon
        var parkNon = L.icon({
            iconUrl: './assets/image/map_control_img/in_car.png',
            iconSize: [15, 15],
        }); //無空位
        var parkOk = L.icon({
            iconUrl: './assets/image/map_control_img/no_car.png',
            iconSize: [15, 15],
        }); //有空位
        // user icon
        var userIcon = L.icon({
            iconUrl: './assets/image/map_control_img/user_place.png',
            iconSize: [40, 40],
        });

        let usermarker, userZoomed, userlat, userlng;

        // 持續刷新使用者位置並取得路邊停車點位
        // 取得使用者點位
        navigator.geolocation.watchPosition(success, error);

        // 提示未啟用定位
        function error(err) {
            if (err.code === 1) {
                alert("無法獲得位置資訊，請開啟定位功能或使用搜尋欄搜尋您所在地點");
            } else {
                alert('已啟用定位功能')
            }
        }

        // 標籤匯入class
        let parkingClass = (markClass, className) => {
            let mark = markClass.closePopup();
            mark._icon.classList.add(className);
        }
        // 用來儲存距離和點位經緯度
        let targetPoint = [];
        let targetDis = [];

        $('#targetBtn').on('click', function () {
            // console.log(Math.min(...targetDis));
            let targetIndex = targetDis.indexOf(Math.min(...targetDis));
            // console.log(targetPoint[targetIndex]);
            var url = 'https://www.google.com/maps/dir/?api=1&destination=' + targetPoint[targetIndex][0] + ',' + targetPoint[targetIndex][1];
            window.open(url);
        });

        // 讀取搜尋框資料，儲存為sessionStorage
        $("#searchPlace").keypress(function(event) {
            if(event.which === 13){
                info = $('#searchPlace').val();
                // console.log(info);
                sessionStorage.setItem('searchInfo', info);
                window.location = './mobile_v13.html';
            }
        })

        function success(pos) {

            userlat = pos.coords.latitude;
            userlng = pos.coords.longitude;
            // reset marker and circle
            if (usermarker) {
                map.removeLayer(usermarker);
            }
            // add user marker
            usermarker = L.marker([userlat, userlng], { icon: userIcon }).addTo(map);
            map.setView([userlat, userlng], 15);
            // userplace callback
            addUserPlace(1000, userlat, userlng);
            usermarker = L.marker([userlat, userlng], { icon: userIcon }).addTo(map);
        }

        // userplace function
        addUserPlace = (area, userlat, userlng) => {
            refrash_road(area);
            refrash_park();
        }

        function refrash_road(cur_area) {
            // console.log(cur_area);
            $('.roadOkDisabled').remove();
            $('.roadNonDisabled').remove();
            $('.roadOkParents').remove();
            $('.roadNonParents').remove();
            $('.roadOkNormal').remove();
            $('.roadNonNormal').remove();
            let a = 0;
            a = cur_area;
            let car_parking_url = "https://datacenter.taichung.gov.tw/Swagger/OpenData/791a8a4b-ade6-48cf-b3ed-6c594e58a1f1";
            let car_parking_xhr = new XMLHttpRequest();
            car_parking_xhr.open('GET', car_parking_url, true);
            car_parking_xhr.send();
            car_parking_xhr.onreadystatechange = function () {
                if (this.readyState === 4 && this.status === 200) {
                    response = JSON.parse(this.response);
                    // console.log(response);
                    $(response).each(function (i, parkInfo) {
                        var roadlat = Number(parkInfo['PS_Lat']);
                        var roadlng = Number(parkInfo['PS_Lng']);
                        switch (parkInfo['PS_type']) {
                            case '1':
                                if (L.latLng(userlat, userlng).distanceTo(L.latLng(roadlat, roadlng)) < a) {
                                    if (parkInfo['status'] == 0) {
                                        targetPoint.push([roadlat, roadlng]);
                                        targetDis.push(L.latLng(userlat, userlng).distanceTo(L.latLng(roadlat, roadlng)));
                                        var markerOK = L.marker([parkInfo['PS_Lat'], parkInfo['PS_Lng']], { icon: parkOk }).addTo(map);
                                        parkingClass(markerOK, 'roadOkDisabled');
                                    } else {
                                        var markerNon = L.marker([parkInfo['PS_Lat'], parkInfo['PS_Lng']], { icon: parkNon }).addTo(map);
                                        parkingClass(markerNon, 'roadNonDisabled');
                                    }
                                }
                                break;
                            case '2':
                                if (L.latLng(userlat, userlng).distanceTo(L.latLng(roadlat, roadlng)) < a) {
                                    if (parkInfo['status'] == 0) {
                                        targetPoint.push([roadlat, roadlng]);
                                        targetDis.push(L.latLng(userlat, userlng).distanceTo(L.latLng(roadlat, roadlng)))
                                        var markerOK = L.marker([parkInfo['PS_Lat'], parkInfo['PS_Lng']], { icon: parkOk }).addTo(map);
                                        parkingClass(markerOK, 'roadOkParents');
                                    } else {
                                        var markerNon = L.marker([parkInfo['PS_Lat'], parkInfo['PS_Lng']], { icon: parkNon }).addTo(map);
                                        parkingClass(markerNon, 'roadNonParents');
                                    }
                                }
                                break;
                            default:
                                if (L.latLng(userlat, userlng).distanceTo(L.latLng(roadlat, roadlng)) < a) {
                                    if (parkInfo['status'] == 0) {
                                        targetPoint.push([roadlat, roadlng]);
                                        targetDis.push(L.latLng(userlat, userlng).distanceTo(L.latLng(roadlat, roadlng)))
                                        var markerOK = L.marker([parkInfo['PS_Lat'], parkInfo['PS_Lng']], { icon: parkOk }).addTo(map);
                                        parkingClass(markerOK, 'roadOkNormal');
                                    } else {
                                        var markerNon = L.marker([parkInfo['PS_Lat'], parkInfo['PS_Lng']], { icon: parkNon }).addTo(map);
                                        parkingClass(markerNon, 'roadNonNormal');
                                    }
                                }
                                break;
                        }
                    })
                };
            }
        }

        function refrash_park() {
            $(".parkDisabled").remove();
            $(".parkParents").remove();
            $(".parkNormal").remove();
            // api匯入
            let parking_park_url = "https://motoretag.taichung.gov.tw/DataAPI/api/ParkingSpotListAPI";
            let parking_park_xhr = new XMLHttpRequest();
            parking_park_xhr.open('GET', parking_park_url, true);
            parking_park_xhr.send();
            parking_park_xhr.onreadystatechange = function () {
                if (this.readyState === 4 && this.status === 200) {
                    response = JSON.parse(this.response);
                    $(response).each(function (i, parkInfo) {
                        $(parkInfo['ParkingLots']).each(function (i, parkMark) {
                            // console.log(parkMark['Type'].includes('1'));
                            targetPoint.push([parkMark['Y'], parkMark['X']]);
                            targetDis.push(L.latLng(userlat, userlng).distanceTo(L.latLng(parkMark['Y'], parkMark['X'])));
                            switch (parkMark['Type'].includes('1')) {
                                case true:
                                    // console.log('身障');
                                    if (parkMark['AvailableCar'] / parkMark['TotalCar'] > 0.6) {
                                        var marker60 = L.marker([parkMark['Y'], parkMark['X']], { icon: park60 }).addTo(map);
                                        parkingClass(marker60, 'parkDisabled');
                                    } else if (parkMark['AvailableCar'] / parkMark['TotalCar'] > 0.3) {
                                        var marker30 = L.marker([parkMark['Y'], parkMark['X']], { icon: park30 }).addTo(map);
                                        parkingClass(marker30, 'parkDisabled');
                                    } else {
                                        var marker0 = L.marker([parkMark['Y'], parkMark['X']], { icon: park0 }).addTo(map);
                                        parkingClass(marker0, 'parkDisabled');
                                    }
                                    break;
                                default:
                                    switch (parkMark['Type'].includes('2')) {
                                        case true:
                                            // console.log('親子車位')
                                            if (parkMark['AvailableCar'] / parkMark['TotalCar'] > 0.6) {
                                                var marker60 = L.marker([parkMark['Y'], parkMark['X']], { icon: park60 }).addTo(map);
                                                parkingClass(marker60, 'parkParents');
                                            } else if (parkMark['AvailableCar'] / parkMark['TotalCar'] > 0.3) {
                                                var marker30 = L.marker([parkMark['Y'], parkMark['X']], { icon: park30 }).addTo(map);
                                                parkingClass(marker30, 'parkParents');
                                            } else {
                                                var marker0 = L.marker([parkMark['Y'], parkMark['X']], { icon: park0 }).addTo(map);
                                                parkingClass(marker0, 'parkParents');
                                            }
                                            break;
                                        default:
                                            // console.log('無特殊車位')
                                            if (parkMark['AvailableCar'] / parkMark['TotalCar'] > 0.6) {
                                                var marker60 = L.marker([parkMark['Y'], parkMark['X']], { icon: park60 }).addTo(map);
                                                parkingClass(marker60, 'parkNormal');
                                            } else if (parkMark['AvailableCar'] / parkMark['TotalCar'] > 0.3) {
                                                var marker30 = L.marker([parkMark['Y'], parkMark['X']], { icon: park30 }).addTo(map);
                                                parkingClass(marker30, 'parkNormal');
                                            } else {
                                                var marker0 = L.marker([parkMark['Y'], parkMark['X']], { icon: park0 }).addTo(map);
                                                parkingClass(marker0, 'parkNormal');
                                            }
                                            break;
                                    }
                                    break;
                            }

                        })
                    })
                }
            }
        }

    </script>

    <!-- ncBtn -->
    <script>
        $('#overlay').hide();
        $('#ncBtn').on('click', function () {
            $('.NCcontainer').css('display', 'block');
            $('.overlay').off('click');
            $('.overlay').hide();
            setTimeout(function () {
                $('.overlay').show();
                $('.overlay').one('click', function () {
                    $('.NCcontainer').css('display', 'none');
                    $('.overlay').hide();
                })
            });
        });




        // 通知中心內容
        window.onload = function () {
            document.getElementById("allPage").click();
        };

        // 導入資料+分頁
        function btnAll() {
            $("#div1").show();
            $("#div2").hide();
            $("#div3").hide();
            $("#div4").hide();
            $('#div5').show();
        }
        function btnAdd() {
            $('#div1').hide();
            $('#div2').show();
            $('#div3').hide();
            $('#div4').hide();
            $('#div5').hide();
        }

        function btnMin() {
            $('#div1').hide();
            $('#div2').hide();
            $('#div3').show();
            $('#div4').hide();
            $('#div5').hide();
        }

        function btnAready() {
            $('#div1').hide();
            $('#div2').hide();
            $('#div3').hide();
            $('#div4').show();
            $('#div5').hide();
        }

        function btnNo() {
            $('#div1').hide();
            $('#div2').hide();
            $('#div3').hide();
            $('#div4').hide();
            $('#div5').show();
        }

        allData = [];
        $.ajax({
            url: "http://localhost:3000/select/traderecord/1",
            type: "GET"
        }).done(function (x) {
            var traderecord = JSON.parse(x);
            // console.log(traderecord);
            traderecord.sort(function (a, b) {
                return new Date(b.tr_date + ' ' + b.tr_time) - new Date(a.tr_date + ' ' + a.tr_time);
            });

            // console.log(traderecord);
            allData = traderecord;

            for (i = 0; i < traderecord.length; i++) {
                var type;
                switch (traderecord[i].tr_type) {
                    case 0: type = "儲值";
                        break;
                    case 1: type = "提款";
                        break;
                    case 2: type = "繳費";
                        break;
                }
                // console.log(type);
                if (type == "繳費") {
                    $("#div4").append(
                        `<div class="row placeCenter mb-3 ">
                                <div class="col-12 card border border-light rounded-3">
                                        <span class="cardTitle" style="color: #34A853;"><b class="me-1">${traderecord[i].tr_date}</b><b class="me-3">${traderecord[i].tr_time}</b><b>${type}成功</b></span>
                                    <div class="cardText">
                                        <span><b>${traderecord[i].tr_location}</b></span>
                                        <span class="cardMoney"><i class="fa fa-dollar"></i><b>${traderecord[i].tr_amount}</b></span>
                                    </div>
                                        <span class="cardDate">${traderecord[i].tr_ps}</span>
                                </div>
                            </div>`
                    );
                } else if (type == "儲值") {
                    // console.log(type);
                    $("#div2").append(
                        `<div class="row placeCenter mb-3">
                                <div class="col-12 card border border-light rounded-3">
                                        <span class="cardTitle" style="color: #34A853;"><b class="me-1">${traderecord[i].tr_date}</b><b class="me-3">${traderecord[i].tr_time}</b><b>${type}成功</b></span>
                                    <div class="cardText">
                                        <span><b>[${type}]${traderecord[i].tr_counterparty}</b></span>
                                        <span class="cardMoney"><i class="fa fa-dollar"></i><b>${traderecord[i].tr_amount}</b></span>
                                    </div>
                                        <span class="cardDate">${traderecord[i].tr_date}</span>
                                </div>
                            </div>`
                    );
                } else if (type == "提款") {
                    // console.log(type);
                    $("#div3").append(
                        `<div class="row placeCenter mb-3">
                                <div class="col-12 card border border-light rounded-3">
                                        <span class="cardTitle" style="color: #34A853;"><b class="me-1">${traderecord[i].tr_date}</b><b class="me-3">${traderecord[i].tr_time}</b><b>${type}成功</b></span>
                                    <div class="cardText">
                                        <span><b>[${type}]${traderecord[i].tr_counterparty}</b></span>
                                        <span class="cardMoney"><i class="fa fa-dollar"></i><b>${traderecord[i].tr_amount}</b></span>
                                    </div>
                                        <span class="cardDate">${traderecord[i].tr_date}</span>
                                </div>
                            </div>`
                    );
                }


            }

            for (i = 0; i < allData.length; i++) {
                var type;
                switch (allData[i].tr_type) {
                    case 0: type = "儲值";
                        break;
                    case 1: type = "提款";
                        break;
                    case 2: type = "繳費";
                        break;
                }
                if (type == "繳費") {
                    $("#div1").append(
                        `<div class="row placeCenter mb-3 ">
                                <div class="col-12 card border border-light rounded-3">
                                        <span class="cardTitle" style="color: #34A853;"><b class="me-1">${allData[i].tr_date}</b><b class="me-3">${allData[i].tr_time}</b><b>${type}成功</b></span>
                                    <div class="cardText">
                                        <span><b>${allData[i].tr_location}</b></span>
                                        <span class="cardMoney"><i class="fa fa-dollar"></i><b>${allData[i].tr_amount}</b></span>
                                    </div>
                                        <span class="cardDate">${allData[i].tr_ps}</span>
                                </div>
                            </div>`
                    );
                } else {
                    $("#div1").append(
                        `<div class="row placeCenter mb-3">
                                <div class="col-12 card border border-light rounded-3">
                                        <span class="cardTitle" style="color: #34A853;"><b class="me-1">${allData[i].tr_date}</b><b class="me-3">${allData[i].tr_time}</b><b>${type}成功</b></span>
                                    <div class="cardText">
                                        <span><b>[${type}]${allData[i].tr_counterparty}</b></span>
                                        <span class="cardMoney"><i class="fa fa-dollar"></i><b>${allData[i].tr_amount}</b></span>
                                    </div>
                                        <span class="cardDate">${allData[i].tr_date}</span>
                                </div>
                            </div>`
                    );
                }
            }

        })

        // setTimeout("console.log(data);", 3000);


        var noData = [];
        // 尚未繳費
        $.ajax({
            url: "http://localhost:3000/select/payment/a02-300a",
            type: "GET"
        }).done(function (x) {
            var datafromS = JSON.parse(x);
            // console.log(datafromS);
            // console.log(x)
            datafromS.sort(function (a, b) {
                return new Date(b.py_ps_d) - new Date(a.py_ps_d);
            });

            noData = datafromS;

            for (i = 0; i < datafromS.length; i++) {
                // console.log(datafromS[i]);
                $("#div5").append(
                    `<div class="row placeCenter mb-3">
                        <div class="col-12 card border border-light rounded-3" id="btnNo">
                            <span class="cardTitle" style="color: #FF4545;"><b>尚未繳費</b></span>
                            <div class="cardText">
                                <span><b>${datafromS[i].py_location}</b></span>
                                <span class="cardMoney"><i class="fa fa-dollar"></i><b>${datafromS[i].py_amount}</b></span>
                                <p class="cardDate">${datafromS[i].py_ps_d} - ${datafromS[i].py_pe_d}</p>
                            </div>
                        </div>
                    </div>`
                )
            }

        })
        // setTimeout("console.log(noData);", 3000);

    </script>


    <!-- bs js -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous">
        </script>
</body>

</html>